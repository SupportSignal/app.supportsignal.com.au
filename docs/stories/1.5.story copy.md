# Story 1.5: UI Design System Foundation

## Status
**Draft**

## Story
**As a** frontend developer,  
**I want** to establish a comprehensive UI design system and React component specifications based on proven patterns from NDIS systems,  
**so that** both incident capture and analysis workflows have consistent, accessible, and maintainable user interface foundations that align with healthcare compliance standards.

## Acceptance Criteria
1. [ ] All API endpoints implemented with proper TypeScript definitions
2. [ ] Input validation using Convex validators with meaningful error messages
3. [ ] Permission checking integrated into all queries and mutations
4. [ ] Real-time subscriptions for workflow handoffs and collaborative features
5. [ ] Comprehensive error handling with user-friendly messages
6. [ ] API documentation with examples for frontend integration

## Estimation & Planning
- **Story Points**: 5
- **Estimated Complexity**: Medium-High
- **Estimated Time**: 3-4 days
- **Risk Level**: Medium

### Risk Factors
- NDIS system pattern analysis requirements (no existing screenshots provided)
- Design system consistency across multiple workflow types
- Healthcare accessibility standards compliance
- Integration with existing ShadCN UI components

## Tasks / Subtasks
- [ ] **Core Design System Elements** (AC: 1, 2, 6)
  - [ ] Implement official SupportSignal brand color palette with healthcare accessibility
    - [ ] Teal gradient system: teal-light (#3CD7C4), teal-mid (#2CC4B7), teal-deep (#1798A2)
    - [ ] Navy primary (#0C2D55), CTA blue (#287BCB), Success green (#27AE60)
    - [ ] Background grey (#F4F7FA), Alert amber (#F2C94C) for notifications
  - [ ] Establish typography scale with healthcare readability standards
    - [ ] Clean, modern sans-serif font system (matching supportsignal.com.au branding)
    - [ ] Header hierarchy: h1 (4xl-6xl), h2 (3xl-4xl), h3 (xl-2xl), body (base-lg)
  - [ ] Create SupportSignal branded layout grid system
    - [ ] 240px fixed sidebar + responsive main content area (proven pattern)
    - [ ] Container max-width 1400px with 2rem center alignment
    - [ ] Component spacing scale: 8px (xs), 12px (sm), 16px (md), 24px (lg), 32px (xl)
  - [ ] Define component naming conventions with healthcare context
    - [ ] Incident-specific components (IncidentCard, StatusBadge, etc.)
    - [ ] SupportSignal branding elements (logo integration, tagline positioning)
    - [ ] WCAG 2.1 AA compliance standards for NDIS requirements
- [ ] **Incident Management UI Components** (AC: 1, 3, 4)
  - [ ] IncidentCard component for incident list displays
  - [ ] StatusBadge component with workflow status indicators
  - [ ] MetadataDisplay component for incident details
  - [ ] WorkflowProgress component showing capture/analysis stages
  - [ ] ActionButton component with permission-aware visibility
- [ ] **Narrative Management UI Components** (AC: 1, 4, 5)
  - [ ] NarrativePhaseEditor component for multi-phase content entry
  - [ ] EnhancementIndicator component showing AI-enhanced content
  - [ ] AutoSaveStatus component with real-time save indicators
  - [ ] NarrativeProgress component tracking completion status
- [ ] **Analysis UI Components** (AC: 1, 3, 5)
  - [ ] ConditionsEditor component for contributing conditions analysis
  - [ ] ClassificationDisplay component for incident type/severity
  - [ ] ConfidenceIndicator component showing AI classification confidence
  - [ ] AnalysisWorkflow component for step-by-step analysis process
- [ ] **User & Session UI Components** (AC: 1, 3)
  - [ ] UserProfile component with role-based display
  - [ ] PermissionIndicator component showing access levels
  - [ ] SessionStatus component with workflow state recovery
  - [ ] WorkflowWizard component for step-by-step guided processes
- [ ] **Real-time & Collaborative UI Components** (AC: 4)
  - [ ] LiveStatusIndicator component for real-time updates
  - [ ] CollaborationBadge component showing multi-user editing
  - [ ] NotificationCenter component for workflow handoff notifications
  - [ ] RealTimeSubscriptionManager for managing live updates
- [ ] **Component Documentation and Integration** (AC: 6)
  - [ ] Storybook stories for all new components with healthcare use case examples
  - [ ] Component integration examples showing usage with Convex APIs
  - [ ] Accessibility testing documentation for healthcare compliance
  - [ ] Design system documentation with component specifications

## Documentation Impact Assessment
- **Architectural patterns**: UI design system patterns, healthcare component accessibility standards, NDIS compliance interface patterns
- **Documentation updates needed**: 
  - `docs/patterns/frontend-patterns.md` - Add comprehensive UI design system patterns
  - `docs/examples/frontend/` - Create healthcare component implementation examples
  - `docs/architecture/components.md` - Update with actual component specifications
  - `docs/technical-guides/` - Create UI integration guide for Epic 2/3 teams
- **New knowledge to capture**: 
  - Healthcare accessibility compliance patterns
  - NDIS system interface design standards
  - Component design patterns for incident workflows
  - Real-time UI update patterns for collaborative editing

## Dev Notes

### Previous Story Context
[Source: docs/stories/1.4.story.md - Dev Agent Record]
- **Core API Layer Complete**: 87% API implementation (13/15 core APIs working) with comprehensive Convex backend
- **Real-time Infrastructure**: Complete implementation of collaborative subscriptions and live update patterns
- **Permission System Integration**: Full role-based access control with 4-role hierarchy (system_admin > company_admin > team_lead > frontline_worker)
- **Data Models Available**: Complete incident, narrative, and analysis data structures ready for UI integration
- **Testing Infrastructure**: Comprehensive API testing patterns and authentication integration established

### Technology Stack Context
[Source: docs/architecture/tech-stack.md]
**UI Technologies for Design System Implementation**:
- **Next.js**: 14.2.x - App Router with Server/Client Component patterns
- **TypeScript**: 5.4.x - Type safety for component interfaces and prop definitions
- **ShadCN/UI & Tailwind**: Latest - Accessible component library foundation and utility-first CSS
- **Storybook**: 8.1.x - UI component workshop for isolated development and documentation
- **React Hook Form**: Form state management with Zod validation integration
- **Zustand**: 4.5.x - Client state management for ephemeral UI state

### SupportSignal Brand Integration Context
[Source: https://supportsignal.com.au/ + Brand Assets Analysis]
**Official Brand Color System** (Tailwind Custom Config):
```javascript
colors: {
  'teal-light': '#3CD7C4',    // Primary brand gradient start
  'teal-mid': '#2CC4B7',      // Primary brand gradient middle
  'teal-deep': '#1798A2',     // Primary brand gradient end
  'navy': '#0C2D55',          // Primary text and headers
  'bg-grey': '#F4F7FA',       // Background sections
  'cta-blue': '#287BCB',      // Call-to-action buttons
  'success-green': '#27AE60', // Success states and confirmations
  'alert-amber': '#F2C94C'    // Warning and alert states
}
```

**Brand Typography & Layout Patterns**:
- **Tagline**: "Where insight meets action" (consistent positioning)
- **Logo Integration**: Teal gradient symbol + navy text (responsive sizing)
- **Typography Hierarchy**: Bold headers (navy), readable body text, emphasis on clarity
- **Layout Pattern**: Container max-width 1400px, responsive grid systems
- **Professional Healthcare Aesthetic**: Clean, white space, subtle shadows, rounded corners

**Brand Voice in UI**:
- **Professional**: Healthcare-appropriate language and terminology
- **Empowering**: Focus on "intelligence", "insights", and "action"
- **NDIS-Specific**: Built by professionals for the NDIS sector
- **Confidence**: "Transform compliance into competitive advantage"

### Frontend Architecture Context
[Source: docs/patterns/frontend-patterns.md]
**Established Component Patterns**:
- **Server-First Components**: Default approach for Next.js App Router, add `"use client"` only when needed
- **ShadCN Component Integration**: Use as base building blocks, customize with SupportSignal brand colors
- **Tailwind-First Approach**: Utility classes with SupportSignal custom color system
- **Component Co-location**: Group components with tests and styles, use index files for clean imports
- **React Hook Form + Zod Integration**: Form state management with SupportSignal styling patterns

### Data Models Context
[Source: docs/architecture/data-models.md and Story 1.4 Implementation]
**Core Data Structures for UI Components**:
```typescript
// Available from Convex API (Story 1.4 implementation)
interface Incident {
  _id: Id<"incidents">;
  company_id: Id<"companies">;
  reporter_name: string;
  participant_name: string;
  event_date_time: string;
  location: string;
  capture_status: "draft" | "in_progress" | "completed";
  analysis_status: "not_started" | "in_progress" | "completed";
  overall_status: "capture_pending" | "analysis_pending" | "completed";
  created_at: number;
  updated_at: number;
  narrative_hash?: string;
  questions_generated: boolean;
  narrative_enhanced: boolean;
  analysis_generated: boolean;
}

interface IncidentNarrative {
  _id: Id<"incident_narratives">;
  incident_id: Id<"incidents">;
  before_event: string;
  during_event: string;
  end_event: string;
  post_event: string;
  consolidated_narrative?: string;
  version: number;
}

interface IncidentClassification {
  _id: Id<"incident_classifications">;
  incident_id: Id<"incidents">;
  incident_type: "behavioural" | "environmental" | "medical" | "communication" | "other";
  severity: "low" | "medium" | "high";
  confidence_score: number;
  supporting_evidence: string;
}
```

### File Locations Context
[Source: docs/architecture/source-tree.md]
**UI Component Implementation Locations**:
- `apps/web/components/ui/` - ShadCN base UI components (EXISTS - extend)
- `apps/web/components/incident/` - Incident management components (NEW)
- `apps/web/components/narrative/` - Narrative workflow components (NEW)
- `apps/web/components/analysis/` - Analysis workflow components (NEW)
- `apps/web/components/shared/` - Shared workflow components (NEW)
- `packages/ui/src/` - Reusable component library (EXISTS - enhance)
- `packages/storybook/stories/` - Component documentation (EXISTS - extend)

### Permission Integration Context
[Source: Story 1.3 & 1.4 Authentication System]
**Role-Based UI Component Visibility**:
```typescript
// Permission-aware component pattern to implement
interface PermissionAwareProps {
  requiredPermission?: string;
  userRole?: "system_admin" | "company_admin" | "team_lead" | "frontline_worker";
  companyId?: Id<"companies">;
}

// Component visibility matrix for UI design
const ComponentPermissions = {
  IncidentCreate: ["system_admin", "company_admin", "team_lead", "frontline_worker"],
  IncidentEdit: ["system_admin", "company_admin", "team_lead", "frontline_worker"], // own only for frontline
  IncidentDelete: ["system_admin", "company_admin"], 
  AnalysisWorkflow: ["system_admin", "company_admin", "team_lead"],
  AdminSettings: ["system_admin"],
  CompanyManagement: ["system_admin", "company_admin"]
};
```

### Real-Time UI Patterns Context
[Source: Story 1.4 Real-time Implementation]
**Collaborative UI Update Patterns**:
- **Live Status Updates**: Components must subscribe to real-time incident status changes
- **Multi-user Editing Indicators**: Show when multiple users are editing narratives simultaneously
- **Workflow Handoff Notifications**: Visual notifications for status transitions between roles
- **Auto-save Indicators**: Real-time feedback for narrative and analysis content persistence

### Technical Constraints
[Source: docs/architecture/coding-standards.md]
- **TypeScript Strict Mode**: All component props and interfaces must be fully type-safe
- **No Any Policy**: Use of `any` type prohibited in component definitions
- **Accessibility Requirements**: WCAG 2.1 AA compliance for healthcare applications
- **Performance Standards**: Component lazy loading for large workflow interfaces

### Original NDIS System Analysis Context
[Source: NDIS Migration Documentation - Complete System Analysis]
**SupportSignal Branded Layout Architecture**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ SupportSignal                "Where insight meets action"     âŒ˜K [ğŸ”] [âš™ï¸] [ğŸ‘¤] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NAVIGATION â”‚                    WORKFLOW WIZARD AREA                               â”‚
â”‚  (240px)   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  #F4F7FA   â”‚  â”‚ â—â”€â”€â—â”€â”€â—‹â”€â”€â—‹â”€â”€â—‹ Step 2 of 7: Multi-Phase Narrative                â”‚  â”‚
â”‚            â”‚  â”‚ #3CD7C4 teal gradient progress indicator                         â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚ğŸ“Š Dashboardâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚ â”‚        â”‚ â”‚  â”‚   Before Event   â”‚    â”‚   During Event  â”‚  [ğŸ§ª Test Data]         â”‚
â”‚ â”‚ğŸš¨ Incidentsâ”‚  â”‚ #FFFFFF cards    â”‚    â”‚ Rounded 8px     â”‚  #287BCB button         â”‚
â”‚ â”‚â€¢ Create â”‚ â”‚  â”‚ Box shadow      â”‚    â”‚ Border subtle   â”‚                         â”‚
â”‚ â”‚â€¢ View   â”‚ â”‚  â”‚ Participant was â”‚    â”‚ The incident    â”‚                         â”‚
â”‚ â”‚â€¢ Search â”‚ â”‚  â”‚ attending their â”‚    â”‚ occurred when   â”‚                         â”‚
â”‚ â”‚        â”‚ â”‚  â”‚ scheduled...    â”‚    â”‚ participant...  â”‚                         â”‚
â”‚ â”‚ğŸ” Analysis â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚ â”‚â€¢ Review â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚ â”‚â€¢ Progressâ”‚ â”‚  â”‚    End Event    â”‚    â”‚  Post-Event     â”‚                        â”‚
â”‚ â”‚â€¢ Completeâ”‚ â”‚  â”‚ The situation   â”‚    â”‚ Following the   â”‚                        â”‚
â”‚ â”‚        â”‚ â”‚  â”‚ was resolved    â”‚    â”‚ incident, we    â”‚                        â”‚
â”‚ â”‚ğŸ‘¥ Users   â”‚  â”‚ by staff...     â”‚    â”‚ provided...     â”‚                        â”‚
â”‚ â”‚ğŸ“ˆ Reports â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚ â”‚ğŸ¨ Dev Toolsâ”‚                                                                   â”‚
â”‚ â”‚âš™ï¸ Settings â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    Back    â”‚   ğŸ’¾ Save    â”‚    Next    â”‚ âœ… Auto-saved     â”‚   â”‚
â”‚ [âš¡ Live]  â”‚  â”‚ â† Previous â”‚   Draft      â”‚ Continue â†’ â”‚ #27AE60 success   â”‚   â”‚
â”‚ [ğŸŒ™ Dark]  â”‚  â”‚ #6B7280    â”‚   #287BCB    â”‚ #3CD7C4   â”‚ indicator         â”‚   â”‚
â”‚ #0C2D55    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ Navy text  â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Color-Coded UI Elements**:
- **ğŸŸ¢ Teal Gradient (#3CD7C4 â†’ #2CC4B7 â†’ #1798A2)**: Logo, progress indicators, primary actions
- **ğŸ”µ Navy (#0C2D55)**: Headers, primary text, navigation labels
- **ğŸ”˜ Background Grey (#F4F7FA)**: Sidebar background, section dividers
- **ğŸ”µ CTA Blue (#287BCB)**: Action buttons, form submits, primary interactions
- **âœ… Success Green (#27AE60)**: Confirmations, auto-save indicators, completed states
- **âš ï¸ Alert Amber (#F2C94C)**: Warnings, validation errors, attention states

**Component Architecture** (Radix UI + Custom):
- **Radix UI Base Components**: Dialog, Label, Progress, Slot (proven accessibility)
- **Custom Healthcare Components**: Incident workflows, narrative editors, analysis tools
- **Tailwind v4 Custom Layers**: `@layer components` for complex healthcare-specific styling
- **Wizard Framework**: Reusable step management with progress indicators and validation

**Navigation Structure**:
```
SIDEBAR MENU:
â”œâ”€â”€ ğŸ“Š Dashboard (overview, metrics)
â”œâ”€â”€ ğŸš¨ Incidents (Create, View, Search) 
â”œâ”€â”€ ğŸ” Analysis (Review, In Progress, Completed)
â”œâ”€â”€ ğŸ‘¥ Users & Roles (permission management)
â”œâ”€â”€ ğŸ“ˆ Reports & Analytics (compliance exports)
â”œâ”€â”€ ğŸ¨ UI Showcase (dev components) â† EXISTING SupportSignal
â”œâ”€â”€ ğŸ”§ Developer Tools â† EXISTING SupportSignal  
â”‚   â”œâ”€â”€ Console Logs â† EXISTING
â”‚   â”œâ”€â”€ Component Tests â† EXISTING
â”‚   â””â”€â”€ Debug Info â† EXISTING
â””â”€â”€ âš™ï¸ Settings (Theme, API, Profile)
```

**Healthcare Interface Requirements**:
- **Accessibility Compliance**: WCAG 2.1 AA standards for disability services (proven in original)
- **Professional Aesthetics**: Clean, healthcare-appropriate interface (240px sidebar + main content)
- **Wizard Integration**: Progress indicators with clickable previous steps (validated pattern)
- **Responsive Grid**: 2x2 narrative grid collapsing to single column on mobile
- **Auto-save Patterns**: Real-time save with 300ms debouncing for data integrity

## Pattern Validation
- Follow existing Next.js App Router patterns with Server/Client component boundaries
- Use established ShadCN UI integration patterns from existing components
- Follow permission-aware component patterns established in Story 1.3/1.4 authentication
- Use real-time subscription patterns from Story 1.4 collaborative features
- Integrate with existing Convex query/mutation patterns for data binding
- Follow healthcare accessibility standards for professional NDIS service environments

## Testing
**Test Location**: `tests/web/components/` directory (centralized testing pattern)
**Testing Framework**: Jest with React Testing Library

**Required Test Coverage**:
- **Component Rendering**: All UI components render correctly with various prop combinations
- **Permission Integration**: Component visibility based on user roles and permissions
- **Real-time Updates**: Component updates in response to live data changes
- **Accessibility**: WCAG 2.1 AA compliance testing for healthcare standards
- **User Interactions**: Form inputs, button clicks, and workflow progression
- **Error States**: Component behavior with invalid data and error conditions

**Storybook Documentation**:
- All components documented with healthcare use case examples
- Interactive component playground for design validation
- Accessibility documentation and testing integration

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-08 | 1.0 | Initial story creation with comprehensive UI design system requirements, healthcare compliance focus, and integration with Stories 1.1-1.4 infrastructure | Bob (SM) |
| 2025-08-08 | 1.1 | Enhanced with original NDIS system analysis, proven layout patterns, component architecture details (Radix UI "Rico" components), and complete navigation structure integration | Bob (SM) |
| 2025-08-08 | 1.2 | Added official SupportSignal brand integration: complete color palette, typography system, logo usage, tagline positioning, and color-coded ASCII layout mockup with healthcare branding | Bob (SM) |