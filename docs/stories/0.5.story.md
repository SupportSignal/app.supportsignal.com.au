# Story 0.5: File Naming Migration to Kebab-Case Standard

## Status
Draft - Ready for Approval

## Story
**As a** development team maintaining the SupportSignal codebase,
**I want** to migrate all component files to kebab-case naming with automated tooling,
**so that** we achieve consistent file naming across the codebase, reduce case-sensitivity issues, and improve grep/search accuracy.

## Context

This story implements Phase 3 from Story 0.4, which was separated due to:
- **Large scope**: 50-100 files need renaming
- **High risk**: Every rename requires updating all import statements
- **Tooling requirement**: Manual migration too error-prone, needs automation
- **Clear separation**: File naming is architecturally distinct from type safety (Story 0.4 Phases 1-2)

**Decision Made in Story 0.4**: Kebab-case is the standard (e.g., `user-profile.tsx` exports `UserProfile`)

**Rationale**:
- Industry standard for web projects
- Consistent with existing patterns (routes, directories, config files)
- Case-insensitive file system compatibility
- Easier to grep and parse

## Acceptance Criteria

**Phase 1 - Tooling Setup**:
- [ ] Research and select codemod tool (jscodeshift or ts-morph)
- [ ] Create migration script with dry-run capability
- [ ] Script identifies all PascalCase component files
- [ ] Script generates kebab-case equivalents correctly
- [ ] Script validates no naming conflicts will occur
- [ ] Comprehensive logging of all changes

**Phase 2 - Safe Migration**:
- [ ] Run migration script in dry-run mode
- [ ] Review all proposed changes
- [ ] Create pre-migration git commit checkpoint
- [ ] Execute migration for `apps/web/components/` first (isolated scope)
- [ ] Verify imports updated correctly
- [ ] Run full test suite
- [ ] Commit incremental changes

**Phase 3 - Full Rollout**:
- [ ] Migrate `apps/web/app/` directory
- [ ] Migrate remaining directories
- [ ] Update any hardcoded file references in config
- [ ] Verify no broken imports or references
- [ ] Run full regression testing

**Phase 4 - Import Path Cleanup**:
- [ ] Identify relative imports (e.g., `../../../../components/`)
- [ ] Convert to path aliases (e.g., `@/components/`)
- [ ] Update ESLint to warn on relative imports
- [ ] Verify all imports resolve correctly

**Validation (All Phases)**:
- [ ] `bun run typecheck` passes with zero errors
- [ ] `bun run lint` passes with zero warnings
- [ ] `bun test` passes (all tests green)
- [ ] `bun run build` completes successfully
- [ ] No console errors in development mode
- [ ] All route navigation works correctly

**Documentation**:
- [ ] Document kebab-case standard in coding standards
- [ ] Document migration script usage
- [ ] Update file naming conventions guide
- [ ] Record lessons learned for future migrations

## Estimation & Planning

### Story Points
**8 Points** (Medium-High Complexity)

### Estimated Complexity
**Medium-High**
- Automated tooling required
- High file count (50-100 files)
- Import resolution complexity
- Risk of breaking changes

### Estimated Time
**6-10 hours**
- Tooling research and setup: 2-3 hours
- Migration script development: 2-3 hours
- Incremental migration execution: 2-3 hours
- Testing and validation: 1-2 hours

### Risk Assessment

**HIGH RISKS**:
1. **Broken Imports** - Highest risk, automated tooling must handle all import paths
   - Mitigation: Comprehensive dry-run mode with logging
   - Mitigation: Incremental migration (components first, then app)
   - Mitigation: Full test suite execution after each phase

2. **Dynamic Imports** - Script may miss `import()` or `require()` statements
   - Mitigation: Search for dynamic import patterns separately
   - Mitigation: Manual review of migration output
   - Mitigation: E2E tests catch runtime issues

3. **Next.js File-System Routes** - Page files have naming implications for URLs
   - Mitigation: Exclude `app/*/page.tsx` and `app/*/layout.tsx` from migration
   - Mitigation: These files already follow Next.js conventions

**MEDIUM RISKS**:
4. **Barrel Export Breaking** - `index.ts` imports may break
   - Mitigation: Script must update barrel export `export * from` statements
   - Mitigation: Test component imports after migration

5. **Case-Sensitive Git** - Git may not detect renames on case-insensitive systems
   - Mitigation: Use `git mv` for renames (script handles this)
   - Mitigation: Verify git status shows renames, not deletes/adds

**Mitigation Strategy**:
- Phase-by-phase migration (not big-bang)
- Comprehensive dry-run before each phase
- Git checkpoint before each phase
- Full test suite between phases
- Manual review of generated changes
- Rollback plan for each phase

## Technical Approach

### Recommended Tool: jscodeshift

**Why jscodeshift**:
- Industry standard for large-scale code transformations
- AST-based (understands code structure, not just text)
- Handles import path updates automatically
- Supports TypeScript out of the box
- Dry-run mode built-in

**Alternative**: ts-morph
- More TypeScript-native
- Steeper learning curve
- Better for complex type transformations (not needed here)

### Migration Script Requirements

**Script Capabilities**:
1. Find all PascalCase `.tsx` and `.ts` component files
2. Convert to kebab-case (e.g., `UserProfile.tsx` → `user-profile.tsx`)
3. Update all import statements referencing renamed files
4. Handle both relative and absolute imports
5. Update `export * from` statements in barrel files
6. Use `git mv` for renames (preserve git history)
7. Comprehensive logging of all changes
8. Dry-run mode with detailed preview

**Script Exclusions**:
- `app/*/page.tsx` - Next.js routing convention
- `app/*/layout.tsx` - Next.js routing convention
- `app/*/error.tsx` - Next.js routing convention
- `app/*/loading.tsx` - Next.js routing convention
- Already kebab-case files (e.g., `ui/button.tsx`)

**Script Output**:
- List of all files to rename
- List of all files with imports to update
- Conflict detection report
- Dry-run diff preview

### File Naming Rules

**Pattern**:
```
PascalCase file → kebab-case file
UserProfile.tsx → user-profile.tsx
AIPromptEditor.tsx → ai-prompt-editor.tsx
CompanySettings.tsx → company-settings.tsx
```

**Export Pattern Stays Same**:
```typescript
// File: user-profile.tsx
export function UserProfile() {
  // Component name stays PascalCase
}
```

**Import Pattern After Migration**:
```typescript
// Before
import { UserProfile } from '@/components/UserProfile';

// After
import { UserProfile } from '@/components/user-profile';
```

## Testing Strategy

### Test Phases

**Phase 1 - Script Testing**:
- Run script in dry-run mode
- Verify all file renames are correct
- Verify no naming conflicts
- Review import update plan

**Phase 2 - Component Migration Testing**:
- After migrating `apps/web/components/`:
  - `bun run typecheck` - verify no type errors
  - `bun run lint` - verify no lint errors
  - `bun test` - run unit tests
  - Manual verification of component imports

**Phase 3 - App Migration Testing**:
- After migrating `apps/web/app/`:
  - Full typecheck, lint, test suite
  - E2E tests if available
  - Manual smoke testing of all major routes
  - Verify no console errors

**Phase 4 - Import Cleanup Testing**:
- After converting relative imports:
  - Full typecheck (verify path aliases work)
  - Full test suite
  - Build verification

### Rollback Testing
- Test rollback from each phase checkpoint
- Verify git reset restores working state
- Document rollback commands in story

## Dependencies

**Required Tools**:
- `jscodeshift` (install: `bun add -D jscodeshift @types/jscodeshift`)
- `@babel/parser` (for TypeScript parsing)

**Required Knowledge**:
- Story 0.4 completion notes (context for this migration)
- File naming decision rationale (kebab-case standard)
- Component file locations and patterns

**Blocking Dependencies**: None

## Success Metrics

**Primary Metrics**:
- ✅ 100% of component files follow kebab-case naming
- ✅ 0 broken imports after migration
- ✅ All tests pass after migration
- ✅ Build succeeds without warnings

**Secondary Metrics**:
- ✅ Import path consistency improved (relative → `@/`)
- ✅ ESLint rule active to prevent future violations
- ✅ Documentation updated with naming standard
- ✅ Migration script reusable for future projects

**Quality Metrics**:
- ✅ No git history loss (renames tracked properly)
- ✅ No manual fixes required after migration
- ✅ Incremental migration allows easy rollback
- ✅ Comprehensive logging for audit trail

## Implementation Notes

### Pre-Implementation Checklist

- [ ] Review Story 0.4 completion notes for context
- [ ] Verify kebab-case decision rationale documented
- [ ] Create feature branch: `story-0.5-file-naming-migration`
- [ ] Install jscodeshift: `bun add -D jscodeshift @types/jscodeshift`
- [ ] Create migration script directory: `scripts/migrations/`

### Migration Execution Checklist

**Before Each Phase**:
- [ ] Commit all pending changes
- [ ] Run full test suite (verify starting state)
- [ ] Document current commit hash (rollback point)

**During Phase**:
- [ ] Run migration script in dry-run mode
- [ ] Review all proposed changes
- [ ] Execute migration script (real mode)
- [ ] Verify git status shows renames (not delete/add)

**After Each Phase**:
- [ ] Run `bun run typecheck`
- [ ] Run `bun run lint`
- [ ] Run `bun test`
- [ ] Manual verification of changed imports
- [ ] Commit with descriptive message
- [ ] Document commit hash in story

### Post-Implementation Tasks

- [ ] Update `docs/architecture/coding-standards.md` with kebab-case standard
- [ ] Document migration script in `scripts/migrations/README.md`
- [ ] Add ESLint rule to prevent PascalCase file names (if available)
- [ ] Capture lessons learned in story completion notes
- [ ] Update story status to "Done"

## Dev Agent Record

### Git Safety
_To be filled during implementation_

**Checkpoints**:
- Starting commit: [TBD]
- Phase 1 commit (tooling): [TBD]
- Phase 2 commit (components): [TBD]
- Phase 3 commit (app): [TBD]
- Phase 4 commit (imports): [TBD]

**Rollback Commands**:
- To before migration: `git reset --hard [starting-commit]`
- To after tooling setup: `git reset --hard [phase-1-commit]`
- To after components: `git reset --hard [phase-2-commit]`
- To after app: `git reset --hard [phase-3-commit]`

### Completion Notes
_To be filled by Dev Agent after implementation_

### File List
_To be filled by Dev Agent after implementation_

## QA Results

### Pattern Compliance Review
_To be filled by QA Agent after implementation_

### Knowledge Capture Reference
_To be filled by QA Agent after implementation_

### Velocity Data
_To be filled by QA Agent after implementation_
