# Story 0.5: File Naming Migration to Kebab-Case

## Status
Draft

## Story
**As a** development team maintaining the SupportSignal codebase,
**I want** to migrate all component files to kebab-case naming with automated tooling,
**so that** we achieve consistent file naming across the codebase, reduce case-sensitivity issues, and improve grep/search accuracy.

## Acceptance Criteria

1. Migration script created using jscodeshift for automated AST-based transformation
2. Script can run in dry-run mode showing all proposed changes before execution
3. Script identifies all PascalCase component files (`.tsx`, `.ts`) and generates kebab-case equivalents
4. Script updates all import statements automatically across the codebase
5. Script handles barrel exports (`export * from`) correctly
6. Script uses `git mv` to preserve git history for renamed files
7. Script validates no naming conflicts will occur before execution
8. Components directory migrated first (isolated scope for validation)
9. App directory migrated second after components validation passes
10. All imports updated to path aliases (`@/`) instead of relative paths (`../../`)
11. ESLint rule added to warn on relative imports (prevent regressions)
12. Full test suite passes after migration (`bun test`, `bun test:e2e`)
13. `bun run typecheck` passes with zero errors
14. `bun run build` completes successfully
15. Documentation updated with kebab-case standard and migration script usage
16. Rollback points documented for each migration phase

## Estimation & Planning

### Story Points
**8** (Medium-High Complexity)

### Estimated Complexity
**Medium-High**

Complexity drivers:
- Large scope (50-100 files to rename)
- High risk (import resolution across entire codebase)
- Automated tooling required (jscodeshift development)
- Multiple phases with validation between each
- Git history preservation requirements

### Estimated Time
**6-10 hours**

Breakdown:
- Tooling research and selection: 1-2 hours
- Migration script development and testing: 2-3 hours
- Phased migration execution: 2-3 hours
- Testing and validation: 1-2 hours
- Documentation and cleanup: 1 hour

### Risk Level
**High**

**Risk Factors**:
1. **Broken Imports** - Automated tool must handle all import patterns
2. **Dynamic Imports** - May miss `import()` or `require()` statements
3. **Next.js Conventions** - Page/layout files have special naming requirements
4. **Case-Sensitive Git** - Renames may not be detected on case-insensitive systems
5. **Barrel Export Breaking** - `index.ts` imports may break if not handled

**Mitigation Strategy**:
- Comprehensive dry-run before each phase
- Incremental migration (components → app → cleanup)
- Git checkpoint before each phase with documented rollback
- Full test suite execution between phases
- Manual review of generated changes

## Documentation Impact Assessment

**Architectural Patterns**:
- File naming conventions (kebab-case for files, PascalCase for exports)
- Import path standards (`@/` aliases vs relative paths)
- Migration automation patterns (jscodeshift usage)

**Documentation Updates Required**:
- `docs/architecture/coding-standards.md` - Add file naming section
- `scripts/migrations/README.md` - Document migration script usage
- New pattern file: `docs/patterns/file-naming-patterns.md`

**Knowledge Capture Requirements**:
- Automated migration patterns (reusable for future projects)
- jscodeshift transformation examples
- Import path cleanup strategies
- Git rename preservation techniques

**Examples to Create**:
- `docs/examples/migrations/jscodeshift-file-rename/` - Complete example

## Tasks / Subtasks

- [ ] **Phase 1: Tooling Setup** (AC: 1-7)
  - [ ] Research jscodeshift vs ts-morph capabilities
  - [ ] Install jscodeshift: `bun add -D jscodeshift @types/jscodeshift @babel/parser`
  - [ ] Create `scripts/migrations/` directory
  - [ ] Develop migration script with dry-run mode
  - [ ] Add file identification logic (find PascalCase `.tsx`/`.ts`)
  - [ ] Add name transformation logic (PascalCase → kebab-case)
  - [ ] Add import update logic (handle all import patterns)
  - [ ] Add barrel export handling (`export * from`)
  - [ ] Add git mv integration for history preservation
  - [ ] Add conflict detection (check for existing kebab-case files)
  - [ ] Add comprehensive logging with change preview
  - [ ] Test script on small sample directory

- [ ] **Phase 2: Components Migration** (AC: 8, 12-14)
  - [ ] Create git checkpoint: document commit hash
  - [ ] Run migration script in dry-run mode for `components/`
  - [ ] Review all proposed changes manually
  - [ ] Execute migration script for `components/` directory
  - [ ] Verify git shows renames (not delete/add)
  - [ ] Run `bun run typecheck` - verify no errors
  - [ ] Run `bun run lint` - verify no new warnings
  - [ ] Run `bun test` - verify all tests pass
  - [ ] Manual verification of component imports
  - [ ] Commit Phase 2 changes with descriptive message

- [ ] **Phase 3: App Directory Migration** (AC: 9, 12-14)
  - [ ] Create git checkpoint: document commit hash
  - [ ] Run migration script in dry-run mode for `app/`
  - [ ] Review proposed changes (exclude page.tsx, layout.tsx, error.tsx)
  - [ ] Execute migration script for `app/` directory
  - [ ] Verify git shows renames
  - [ ] Run full validation suite (typecheck, lint, test, build)
  - [ ] E2E tests if available
  - [ ] Manual smoke testing of major routes
  - [ ] Verify no console errors in dev mode
  - [ ] Commit Phase 3 changes

- [ ] **Phase 4: Import Path Cleanup** (AC: 10-11)
  - [ ] Create git checkpoint: document commit hash
  - [ ] Identify all relative imports: `grep -r "\.\./\.\." apps/web --include="*.tsx" --include="*.ts"`
  - [ ] Run import cleanup script (convert to `@/` aliases)
  - [ ] Add ESLint rule to warn on relative imports
  - [ ] Run full validation suite
  - [ ] Commit Phase 4 changes

- [ ] **Phase 5: Documentation & Completion** (AC: 15-16)
  - [ ] Update `docs/architecture/coding-standards.md` with kebab-case standard
  - [ ] Create `scripts/migrations/README.md` documenting script usage
  - [ ] Create pattern file: `docs/patterns/file-naming-patterns.md`
  - [ ] Document all rollback commands in story
  - [ ] Run KDD knowledge capture process
  - [ ] Update story status to "Done"

## Dev Notes

### Context from Previous Story

**Story 0.4 Decision** (Phase 3 deferred to this story):
- Kebab-case standard decided and documented
- File naming migration identified as large scope (50-100 files)
- Requires automated tooling (too error-prone manually)
- High risk due to import resolution complexity

**Decision Rationale**:
- Industry standard for web projects
- Consistent with existing patterns (routes, directories, config)
- Case-insensitive file system compatibility
- Easier to grep and parse
- Better alignment with URL conventions

**Pattern Established**:
```
PascalCase file → kebab-case file
UserProfile.tsx → user-profile.tsx
```

**Export Pattern Unchanged**:
```typescript
// File: user-profile.tsx
export function UserProfile() { ... }  // Component stays PascalCase
```

### Pattern Validation

**Existing Patterns to Follow**:

1. **Component Organization** ([docs/patterns/component-organization-patterns.md](../patterns/component-organization-patterns.md))
   - 3-tier structure: `components/ui/`, `components/features/`, `app/*/components/`
   - Export pattern: `export function ComponentName()`
   - Barrel exports: Strategic use for features

2. **TypeScript Type Safety** ([docs/patterns/typescript-type-safety-patterns.md](../patterns/typescript-type-safety-patterns.md))
   - No `any` types policy
   - Strict mode enabled
   - Type-safe imports must be maintained after migration

3. **Testing Standards** ([docs/testing/technical/test-strategy-and-standards.md](../testing/technical/test-strategy-and-standards.md))
   - All tests in centralized `tests/` directory
   - Use `@/` path aliases (not relative imports)
   - Full test suite must pass after migration

**New Patterns to Establish**:

1. **File Naming Pattern**:
   ```
   Component files: kebab-case.tsx
   Component exports: PascalCase
   Example: user-profile.tsx exports UserProfile
   ```

2. **Automated Migration Pattern**:
   - jscodeshift for AST-based transformations
   - Dry-run validation before execution
   - Incremental migration with checkpoints
   - Git mv for history preservation

3. **Import Path Standard**:
   - Use `@/` aliases: `import { Component } from '@/components/feature'`
   - Avoid relative: `import { Component } from '../../components/feature'`
   - ESLint enforcement to prevent regressions

### Migration Script Requirements

**Tool Selection: jscodeshift**

Why jscodeshift:
- Industry standard for large-scale code transformations
- AST-based (understands code structure, not regex)
- Handles TypeScript out of the box
- Supports import path updates automatically
- Built-in dry-run mode

**Script Capabilities Needed**:
1. Find all PascalCase `.tsx` and `.ts` component files
2. Convert to kebab-case (e.g., `UserProfile.tsx` → `user-profile.tsx`)
3. Update all `import` statements referencing renamed files
4. Update `export * from` statements in barrel files
5. Use `git mv` for renames (preserve history)
6. Comprehensive logging of all changes
7. Conflict detection (check for existing kebab-case files)

**Script Exclusions**:
- `app/*/page.tsx` - Next.js routing convention
- `app/*/layout.tsx` - Next.js routing convention
- `app/*/error.tsx` - Next.js routing convention
- `app/*/loading.tsx` - Next.js routing convention
- Already kebab-case files

**File Naming Rules**:
```typescript
// Pattern
PascalCase file → kebab-case file
UserProfile.tsx → user-profile.tsx
AIPromptEditor.tsx → ai-prompt-editor.tsx
CompanySettings.tsx → company-settings.tsx

// Export stays same
// File: user-profile.tsx
export function UserProfile() {
  // Component name stays PascalCase
}

// Import changes
// Before
import { UserProfile } from '@/components/UserProfile';

// After
import { UserProfile } from '@/components/user-profile';
```

### Testing

**Test Strategy**:

**Phase 1 - Script Testing**:
- Run script in dry-run mode
- Verify all file renames are correct
- Verify no naming conflicts
- Review import update plan

**Phase 2 - Components Migration Testing**:
- After migrating `apps/web/components/`:
  - `bun run typecheck` - verify no type errors
  - `bun run lint` - verify no lint errors
  - `bun test` - run unit tests
  - Manual verification of component imports

**Phase 3 - App Migration Testing**:
- After migrating `apps/web/app/`:
  - Full typecheck, lint, test suite
  - E2E tests if available
  - Manual smoke testing of all major routes
  - Verify no console errors

**Phase 4 - Import Cleanup Testing**:
- After converting relative imports:
  - Full typecheck (verify path aliases work)
  - Full test suite
  - Build verification

**Rollback Testing**:
- Test rollback from each phase checkpoint
- Verify `git reset` restores working state

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | 1.0 | Initial story creation following BMAD template | Claude (Dev Agent) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
_To be filled during implementation_

### Completion Notes
_To be filled during implementation_

### File List
_To be filled during implementation_

## QA Results

### Pattern Compliance Review
_To be filled by QA Agent after implementation_

### Knowledge Capture Reference
_To be filled by QA Agent after implementation - Must reference knowledge base files per KDD process_

### Velocity Data
_To be filled by QA Agent after implementation_
