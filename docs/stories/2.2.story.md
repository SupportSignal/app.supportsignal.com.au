# Story 2.2: Main Application Navigation & Layout Foundation

## Status
Complete ✅

## Story
**As a** SupportSignal user (frontline worker, team leader, administrator),  
**I want** a consistent main application navigation structure with left sidebar, top menu, and bottom menu,  
**so that** I can easily navigate between different areas of the application and understand the overall system layout before engaging with specific workflows like the incident wizard.

## Acceptance Criteria
1. [ ] Left sidebar navigation with role-based menu items for different user types
2. [ ] Top header menu with user profile, notifications, and quick actions
3. [ ] Bottom navigation/footer with system information and secondary links
4. [ ] Responsive design that adapts sidebar to mobile (collapsible/drawer)
5. [ ] Main content area that integrates with wizard and other workflows
6. [ ] Navigation state persistence (active menu items, collapsed states)
7. [ ] WCAG 2.1 AA accessibility compliance for all navigation elements

## Estimation & Planning
- **Story Points**: 8
- **Estimated Complexity**: Medium-High
- **Estimated Time**: 1 week
- **Risk Level**: Medium

### Risk Factors
- Complex responsive navigation patterns for mobile vs desktop
- Role-based navigation requires integration with authentication system
- Navigation state management across different workflows
- Accessibility requirements for complex navigation structures

## Tasks / Subtasks
- [x] **Main Layout Shell Component** (AC: 1, 5)
  - [x] Create `MainLayout` component with navigation areas
  - [x] Implement sidebar, header, footer, and content area structure
  - [x] Add responsive grid/flex layout with proper spacing
  - [x] Integrate with existing `app/layout.tsx` without breaking current functionality
- [x] **Left Sidebar Navigation** (AC: 1, 4, 6)
  - [x] Build collapsible sidebar component with menu items
  - [x] Implement role-based menu item filtering based on user permissions
  - [x] Add mobile drawer functionality for small screens
  - [x] Create navigation state management with persistence
- [x] **Top Header Navigation** (AC: 2, 7)
  - [x] Implement header with SupportSignal branding and user controls
  - [x] Add user profile dropdown with account management links
  - [x] Implement notification badge/icon for system alerts
  - [x] Add breadcrumb navigation for deep navigation contexts
- [x] **Bottom Footer Navigation** (AC: 3)
  - [x] Create footer with secondary navigation and system information
  - [x] Add legal links, version information, and support contact
  - [x] Implement responsive footer layout for mobile
- [x] **Integration and Accessibility** (AC: 5, 7)
  - [x] Integrate navigation with existing wizard flows
  - [x] Implement keyboard navigation support (Tab, Arrow keys, Enter)
  - [x] Add ARIA attributes and screen reader support
  - [x] Test navigation flow with wizard and other existing pages

## Documentation Impact Assessment
- **Architectural patterns**: Main layout patterns, navigation state management, role-based UI patterns
- **Documentation updates needed**: 
  - `docs/architecture/components.md` - Add main layout component specifications
  - `docs/patterns/frontend-patterns.md` - Add navigation and layout patterns
  - `docs/design-system/component-specifications.md` - Update with navigation component specs
  - `docs/examples/frontend/` - Create navigation implementation examples
- **New knowledge to capture**: 
  - Responsive navigation patterns for complex applications
  - Role-based navigation filtering strategies
  - Navigation state persistence patterns
  - Mobile-first navigation design patterns

## UI Design Specification

### ASCII Layout Mockup
[Source: docs/stories/2.0.story.md - SupportSignal Branded Layout Architecture]

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ 🟢 SupportSignal                "Where insight meets action"     ⌘K [🔍] [⚙️] [👤] │
├────────────┬────────────────────────────────────────────────────────────────────────┤
│ NAVIGATION │                    WORKFLOW WIZARD AREA                               │
│  (240px)   │  ┌──────────────────────────────────────────────────────────────────┐  │
│  #F4F7FA   │  │ ●──●──○──○──○ Step 2 of 7: Multi-Phase Narrative                │  │
│            │  │ #3CD7C4 teal gradient progress indicator                         │  │
│ ┌────────┐ │  └──────────────────────────────────────────────────────────────────┘  │
│ │📊 Dashboard│  ┌─────────────────┐    ┌─────────────────┐                        │
│ │        │ │  │   Before Event   │    │   During Event  │  [🧪 Test Data]         │
│ │🚨 Incidents│  │ #FFFFFF cards    │    │ Rounded 8px     │  #287BCB button         │
│ │• Create │ │  │ Box shadow      │    │ Border subtle   │                         │
│ │• View   │ │  │ Participant was │    │ The incident    │                         │
│ │• Search │ │  │ attending their │    │ scheduled...    │                         │
│ │        │ │  │ scheduled...    │    │ participant...  │                         │
│ │🔍 Analysis │  └─────────────────┘    └─────────────────┘                        │
│ │• Review │ │  ┌─────────────────┐    ┌─────────────────┐                        │
│ │• Progress│ │  │    End Event    │    │  Post-Event     │                        │
│ │• Complete│ │  │ The situation   │    │ Following the   │                        │
│ │        │ │  │ was resolved    │    │ incident, we    │                        │
│ │👥 Users   │  │ by staff...     │    │ provided...     │                        │
│ │📈 Reports │  └─────────────────┘    └─────────────────┘                        │
│ │🎨 Dev Tools│                                                                   │
│ │⚙️ Settings │  ┌────────────┬──────────────┬────────────┬───────────────────┐   │
│ └────────┘ │  │    Back    │   💾 Save    │    Next    │ ✅ Auto-saved     │   │
│ [⚡ Live]  │  │ ← Previous │   Draft      │ Continue → │ #27AE60 success   │   │
│ [🌙 Dark]  │  │ #6B7280    │   #287BCB    │ #3CD7C4   │ indicator         │   │
│ #0C2D55    │  └────────────┴──────────────┴────────────┴───────────────────┘   │
│ Navy text  │                                                                    │
└────────────┴────────────────────────────────────────────────────────────────────────┘
```

### Navigation Structure Specification
[Source: docs/stories/2.0.story.md - Navigation Structure]

**SIDEBAR MENU (240px fixed width):**
```
├── 📊 Dashboard (overview, metrics)
├── 🚨 Incidents (Create, View, Search) 
├── 🔍 Analysis (Review, In Progress, Completed)
├── 👥 Users & Roles (permission management)
├── 📈 Reports & Analytics (compliance exports)
├── 🎨 UI Showcase (dev components) ← EXISTING SupportSignal
├── 🔧 Developer Tools ← EXISTING SupportSignal  
│   ├── Console Logs ← EXISTING
│   ├── Component Tests ← EXISTING
│   └── Debug Info ← EXISTING
└── ⚙️ Settings (Theme, API, Profile)
```

### Color-Coded UI Elements
[Source: docs/stories/2.0.story.md - SupportSignal Brand Integration]

- **🟢 Teal Gradient (#3CD7C4 → #2CC4B7 → #1798A2)**: Logo, progress indicators, primary actions
- **🔵 Navy (#0C2D55)**: Headers, primary text, navigation labels
- **🔘 Background Grey (#F4F7FA)**: Sidebar background, section dividers
- **🔵 CTA Blue (#287BCB)**: Action buttons, form submits, primary interactions
- **✅ Success Green (#27AE60)**: Confirmations, auto-save indicators, completed states
- **⚠️ Alert Amber (#F2C94C)**: Warnings, validation errors, attention states

### Layout Requirements

**Header Structure:**
- SupportSignal logo with teal gradient (#3CD7C4)
- Tagline: "Where insight meets action"
- Quick search (⌘K), settings [⚙️], user profile [👤] icons

**Sidebar Navigation (240px):**
- Background: #F4F7FA (light grey)
- Navy text (#0C2D55)
- Role-based menu items with icons
- Live status [⚡ Live] and dark mode [🌙 Dark] toggles at bottom

**Main Content Area:**
- Workflow wizard area for step-by-step processes
- Progress indicators with teal gradient
- 2x2 grid layout for content (collapsible to single column on mobile)

**Bottom Action Bar:**
- Back/Next navigation buttons with color coding
- Save functionality (#287BCB blue) with auto-save indicators (#27AE60 green)
- Status indicators in branded colors

## Current Menu Analysis & Hierarchy

### Existing Homepage Menu Items
[Source: Analysis of apps/web/app/page.tsx - Current Navigation]

**Current Menu Structure:**

**Always Visible (Current State):**
- Home (/) - ✅ OK for signed-out users
- Components (/showcase) - ⚠️ Should be signed-in only (dev tool)
- Wizard Demo (/wizard-demo) - ⚠️ Should be signed-in only (demo tool)
- Dev (/dev) - ⚠️ Should be signed-in only (developer tool)

**Signed-In Only (Current State):**
- Chat (/chat) - ✅ Correctly gated
- Dashboard (/dashboard) - ✅ Correctly gated
- Protected (/protected) - ✅ Correctly gated (test page)
- Debug (/debug-logs) - ✅ Correctly gated

**Additional Routes Found (Not in main nav):**
- Admin (/admin) - Admin role only
- Debug (/debug) - Advanced debug tools
- Test LLM (/test-llm) - LLM testing interface

### Proposed Menu Hierarchy & Grouping

#### **1. Left Sidebar Navigation (Primary Workflow Menus)**
*For core SupportSignal business functionality - All signed-in only*

```
📊 Dashboard (/)
   ├── Overview & Metrics
   └── Recent Activity

🚨 Incidents (Business Workflow)
   ├── 📝 Create New Incident
   ├── 📋 View All Incidents  
   ├── 🔍 Search & Filter
   └── 📊 Incident Analytics

🔍 Analysis (Business Workflow) 
   ├── 📥 Review Queue
   ├── ⏳ In Progress
   ├── ✅ Completed
   └── 📈 Analysis Reports

👥 Users & Roles (Admin)
   ├── 👤 User Management
   ├── 🏢 Company Management
   └── 🔐 Permissions

📈 Reports & Analytics
   ├── 📊 Compliance Reports
   ├── 📋 Export Data
   └── 📅 Scheduled Reports
```

#### **2. Top Header Menu (System & User Functions)**
*Quick access items and user functions*

```
🟢 SupportSignal Logo + "Where insight meets action"
   ├── ⌘K Quick Search
   ├── 🔔 Notifications
   ├── ⚙️ Settings Dropdown
   │   ├── 🎨 Theme (Light/Dark)
   │   ├── 👤 Profile Settings
   │   ├── 🔐 Change Password
   │   └── 🚪 Sign Out
   └── 👤 User Profile
```

#### **3. Developer Tools Section (Collapsible)**
*Development and testing tools - Role-based access*

```
🔧 Developer Tools (Collapsible Section)
   ├── 🧪 Component Showcase (/showcase)
   ├── 🪄 Wizard Demo (/wizard-demo)
   ├── 💬 Chat Interface (/chat)  
   ├── 🐛 Debug Logs (/debug-logs)
   ├── 🔍 Advanced Debug (/debug)
   ├── 🤖 LLM Testing (/test-llm)
   └── ⚡ Dev Utils (/dev)
```

#### **4. Admin System Menu (Role-Based)**
*System administration - Admin role only*

```
👑 Admin (Admin Role Only)
   ├── 🏢 System Settings
   ├── 👥 Global User Management  
   ├── 📊 System Analytics
   ├── 🔧 Feature Flags
   └── 🛠️ Admin Tools (/admin)
```

### Authentication-Based Menu Visibility

#### **Signed-Out Users (Public Access)**
```
Top Header Only:
├── 🏠 Home (/) 
├── 🔗 Sign In (/login)
└── ✨ Sign Up (/register)
```

#### **Signed-In Users (All Roles)**
```
Full Navigation:
├── Left Sidebar (Primary Workflow)
├── Top Header (System Functions)
└── Developer Tools (if enabled)
```

#### **Admin Users (Additional Access)**
```
Full Navigation Plus:
└── Admin System Menu
```

### Menu Type Categories

#### **Workflow Menus (Left Sidebar)**
- **Purpose**: Core business functionality for incident management
- **Location**: Fixed left sidebar (240px)
- **Authentication**: Signed-in required
- **Style**: Professional healthcare interface with SupportSignal branding

#### **System Menus (Top Header Dropdown)**
- **Purpose**: User account, settings, and system functions  
- **Location**: Top header dropdown from ⚙️ icon
- **Authentication**: Signed-in required
- **Style**: Clean dropdown with role-based items

#### **Developer Menus (Collapsible Section)**
- **Purpose**: Development, testing, and debugging tools
- **Location**: Collapsible section in left sidebar (bottom area)
- **Authentication**: Signed-in + developer role
- **Style**: Distinct styling to separate from business functions

#### **Public Menus (Limited Header)**
- **Purpose**: Authentication and marketing
- **Location**: Simplified top header
- **Authentication**: Public access
- **Style**: Clean, minimal branding

### Implementation Recommendations

1. **Move Developer Tools**: Components, Wizard Demo, Dev, Debug tools should move from top nav to collapsible developer section
2. **Role-Based Rendering**: Implement proper role checking for menu visibility
3. **Clean Public Interface**: Signed-out users see minimal, clean interface
4. **Logical Grouping**: Group related functions together (all incident work, all admin work)
5. **Future-Proof**: Structure allows easy addition of new incident workflow features

### Migration Strategy

**Phase 1**: Authentication Gates
- Move demo/dev tools behind authentication
- Implement role-based menu rendering

**Phase 2**: Menu Reorganization  
- Implement left sidebar with workflow menus
- Create system dropdown in header
- Add collapsible developer section

**Phase 3**: Role Refinement
- Add admin-only menus
- Implement company-level permissions
- Add feature flags for progressive rollout

## Dev Notes

### Previous Story Context
[Source: docs/stories/2.1.story.md - Completion Summary]
- **WizardShell Framework**: Complete wizard component available for integration into main layout
- **SupportSignal Design System**: Teal gradient brand colors, navy text, proper spacing established
- **WCAG 2.1 AA Compliance**: Accessibility patterns and testing infrastructure established
- **Mobile-Responsive Patterns**: Touch-friendly interface patterns available for navigation

### Technology Stack Context
[Source: docs/architecture/tech-stack.md]
**Navigation Implementation Technologies**:
- **Next.js**: 14.2.x - App Router with layout.tsx pattern for nested layouts
- **TypeScript**: 5.4.x - Type safety for navigation state and role-based filtering
- **ShadCN/UI**: Navigation components (NavigationMenu, Sheet for mobile drawer)
- **Tailwind CSS**: Responsive utilities for mobile-first navigation design
- **Zustand**: 4.5.x - Client state management for navigation state persistence

### Authentication Integration Context
[Source: docs/stories/1.5.story.md - Authentication Implementation]
**Role-Based Navigation Requirements**:
- **User Roles Available**: Frontline Worker, Team Leader, Administrator
- **Permission Integration**: Navigation menu items filtered based on user role
- **Session Integration**: Navigation state persisted across user sessions

### File Locations Context
[Source: docs/architecture/source-tree.md]
**Navigation Component Implementation Locations**:
- `apps/web/components/layout/main-layout.tsx` - Main application layout shell
- `apps/web/components/layout/sidebar-navigation.tsx` - Left sidebar navigation component  
- `apps/web/components/layout/header-navigation.tsx` - Top header navigation component
- `apps/web/components/layout/footer-navigation.tsx` - Bottom footer navigation component
- `apps/web/components/layout/navigation-types.ts` - Navigation TypeScript interfaces
- `apps/web/lib/navigation/` - Navigation utilities and role-based filtering logic

### Design System Context
[Source: docs/stories/2.0.story.md - UI Design System Foundation]
**SupportSignal Brand Integration**:
- **Primary Colors**: Teal gradient (#0d9488 to #14b8a6) for active navigation states
- **Text Colors**: Navy (#1e293b) for primary navigation text
- **Spacing**: Consistent spacing scale established for navigation padding/margins
- **Icons**: Lucide React icons available for navigation menu items

### Technical Constraints Context
[Source: docs/architecture/coding-standards.md]
**Mandatory Implementation Requirements**:
- **TypeScript Strict Mode**: All navigation interfaces must be fully type-safe
- **No process.env Access**: Use configuration management for environment-dependent navigation
- **Repository Pattern**: Navigation preferences must follow data access abstraction
- **Correlation IDs**: All navigation actions must include correlation IDs for analytics

### Responsive Design Context
[Source: docs/stories/2.1.story.md - Wizard Mobile Patterns]
**Established Mobile Navigation Patterns**:
- **Mobile-First Design**: Start with mobile layout, enhance for desktop
- **Touch-Friendly Targets**: 44px minimum touch target size for navigation items
- **Collapsible Patterns**: Sidebar collapses to hamburger menu on mobile screens
- **iOS Safari/Android Chrome**: Cross-browser compatibility patterns established

## Pattern Validation
- Follow Next.js App Router layout patterns with nested layout structure
- Use ShadCN UI navigation components (NavigationMenu, Sheet) with established theming
- Integrate with existing authentication system for role-based filtering
- Follow SupportSignal design system patterns from Story 2.0
- Use established mobile-responsive patterns from Story 2.1 wizard implementation

## Testing
**Test Location**: `tests/web/components/layout/` directory (centralized testing pattern)
**Testing Framework**: Jest with React Testing Library
**Required Testing Standards**:
- **Component Rendering**: Navigation components render correctly with different user roles
- **Responsive Behavior**: Sidebar collapse/expand functionality on different screen sizes
- **Role-Based Filtering**: Menu items show/hide correctly based on user permissions
- **Navigation State**: State persistence works correctly across page transitions
- **Accessibility Tests**: WCAG 2.1 AA compliance using jest-axe for navigation elements
- **Integration Tests**: Navigation integrates correctly with wizard and other workflows

## Implementation Summary

### Components Created
- **`MainLayout`** - Main application layout shell with conditional sidebar rendering
- **`SidebarNavigation`** - Role-based collapsible sidebar with keyboard navigation
- **`HeaderNavigation`** - Header with branding, search, user controls, and breadcrumbs  
- **`FooterNavigation`** - Footer with legal links and system information
- **`BreadcrumbNavigation`** - Auto-generated breadcrumbs for deep navigation

### Key Features Implemented
- ✅ **Role-based navigation filtering** - Menu items show/hide based on user permissions
- ✅ **Responsive design** - Mobile-first with collapsible sidebar and drawer functionality
- ✅ **Keyboard navigation** - Full Tab, Arrow key, Enter support with focus management
- ✅ **ARIA accessibility** - Screen reader support with proper landmarks and labels
- ✅ **State persistence** - Navigation state maintained across page transitions
- ✅ **SupportSignal branding** - Consistent brand colors and styling throughout
- ✅ **Breadcrumb navigation** - Auto-generated breadcrumbs for deep navigation contexts

### Integration Points
- **Authentication system** - Integrated with existing auth provider for role filtering
- **Theme system** - Works with existing light/dark theme toggle
- **Wizard flows** - Navigation shell contains wizard components without interference
- **Existing pages** - All current pages render within new navigation structure

### Testing Coverage
- Comprehensive test suites created for all navigation components
- Tests cover rendering, interactions, accessibility, responsive behavior, and role filtering
- Located in `tests/web/components/layout/` following centralized testing pattern

### Navigation Structure Implemented
```
Header (always visible)
├── Logo + Branding
├── Search (⌘K) - signed-in only
├── Notifications - signed-in only  
├── Settings dropdown - signed-in only
├── User profile - signed-in only
└── Breadcrumbs - signed-in only

Sidebar (signed-in users only)
├── Main Workflow Section
│   ├── Dashboard
│   ├── Incidents (with submenu)
│   ├── Analysis
│   └── Users & Roles
└── Developer Tools (collapsible, role-based)

Footer (always visible)
├── Legal links
├── System status
└── Version info
```

### Build & Deployment Status
- ✅ **TypeScript compilation** - All components type-safe and compiling
- ✅ **Production build** - Builds successfully with only linting warnings  
- ✅ **Integration testing** - Navigation works with existing wizard and page flows
- ✅ **Accessibility compliance** - WCAG 2.1 AA compliant navigation structure

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-08 | 1.0 | Initial story creation for missing main navigation foundation - identified gap in Epic 2 planning where navigation structure was omitted before workflow implementation | Bob (SM) |
| 2025-08-08 | 2.0 | Complete implementation with all navigation components, accessibility features, and comprehensive testing | James (Dev) |