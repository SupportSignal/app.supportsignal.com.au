# Story 3.5: Mobile-First Responsive Incident Capture

## Status
READY

## Story
**As a** frontline support worker,  
**I want** the 8-step incident capture workflow to be fully optimized for mobile devices,  
**so that** I can efficiently report incidents directly from my smartphone or tablet while in the field, without any usability barriers or interface limitations.

## Acceptance Criteria

1. **Mobile Navigation**: Touch-friendly wizard navigation with swipe gestures and haptic feedback
2. **Responsive Forms**: All form controls optimized for mobile input with proper keyboard types
3. **Viewport Optimization**: Perfect rendering on screen sizes from 375px to 1920px+ width
4. **Touch Targets**: All interactive elements meet 44px minimum touch target size
5. **Mobile Performance**: <3 second initial load, <1 second step transitions on mobile
6. **Offline Support**: Basic offline capabilities with data sync when connection restored
7. **Accessibility**: WCAG 2.1 AA compliance maintained across all viewport sizes
8. **Testing**: Comprehensive testing on iOS Safari, Android Chrome, and mobile browsers
9. **User Testing**: Validation with actual frontline workers using mobile devices
10. **Progressive Web App**: PWA capabilities for app-like experience on mobile devices

## Estimation & Planning

### Story Points
8

### Estimated Complexity  
Medium-High

### Estimated Time
1.5-2 weeks

### Risk Level
Medium (Cross-device compatibility challenges, touch interaction patterns)

## Tasks / Subtasks

- [ ] **Task 3.5.1: Core Wizard & Container Components** (AC: 1, 2, 3)
  - [x] Subtask 3.5.1.1: Mobile optimize `IncidentCaptureWorkflow` main container for viewport detection
  - [ ] Subtask 3.5.1.2: Mobile optimize `WorkflowWizard` for touch navigation and swipe gestures
  - [ ] Subtask 3.5.1.3: Create `MobileWizardShell` component for mobile-specific wizard container
  - [ ] Subtask 3.5.1.4: Create `TouchNavigationBar` component with 44px minimum touch targets

- [ ] **Task 3.5.2: Step 1 - Metadata Form Components** (AC: 2, 4)
  - [ ] Subtask 3.5.2.1: Mobile optimize `IncidentMetadataForm` layout and form structure
  - [ ] Subtask 3.5.2.2: Mobile optimize ShadCN `Input` component with proper `inputMode` attributes
  - [ ] Subtask 3.5.2.3: Mobile optimize ShadCN `Select` component for participant dropdown
  - [ ] Subtask 3.5.2.4: Mobile optimize ShadCN `Calendar` for date/time picker
  - [ ] Subtask 3.5.2.5: Create `MobileDatePicker` component for enhanced mobile date selection

- [ ] **Task 3.5.3: Step 2 - Narrative Grid Components** (AC: 2, 3)
  - [ ] Subtask 3.5.3.1: Mobile optimize `NarrativeGrid` from 2x2 grid to single column on mobile
  - [ ] Subtask 3.5.3.2: Mobile optimize ShadCN `Textarea` for 4 narrative phases
  - [ ] Subtask 3.5.3.3: Create `MobileTextarea` with voice input support and auto-resize
  - [ ] Subtask 3.5.3.4: Add mobile keyboard optimization for narrative text input

- [ ] **Task 3.5.4: Steps 3-6 - Clarification Components** (AC: 1, 2, 4)
  - [ ] Subtask 3.5.4.1: Mobile optimize `ClarificationStep` layout for questions and answers
  - [ ] Subtask 3.5.4.2: Mobile optimize clarification `Textarea` components for touch input
  - [ ] Subtask 3.5.4.3: Mobile optimize clarification action `Button` components (Skip, Continue, Regenerate)
  - [ ] Subtask 3.5.4.4: Mobile optimize AI loading states with `Skeleton` component
  - [ ] Subtask 3.5.4.5: Add touch-friendly question navigation and progress indicators

- [ ] **Task 3.5.5: Steps 7-8 - Review & Report Components** (AC: 2, 3)
  - [ ] Subtask 3.5.5.1: Mobile optimize `EnhancedReviewStepNew` for mobile text editing
  - [ ] Subtask 3.5.5.2: Mobile optimize `ConsolidatedReportStep` final review layout  
  - [ ] Subtask 3.5.5.3: Mobile optimize `Alert` components for enhancement notifications
  - [ ] Subtask 3.5.5.4: Mobile optimize `Card` components for information display sections

- [ ] **Task 3.5.6: Supporting & Utility Components** (AC: 4, 5)
  - [ ] Subtask 3.5.6.1: Mobile optimize `Progress` component for step progress indication
  - [ ] Subtask 3.5.6.2: Mobile optimize `Badge` components for step status indicators
  - [ ] Subtask 3.5.6.3: Mobile optimize `AutoSaveIndicator` positioning and feedback
  - [ ] Subtask 3.5.6.4: Mobile optimize `DeveloperToolsBar` with collapsible mobile layout
  - [ ] Subtask 3.5.6.5: Create mobile utility components (`SwipeHandler`, `MobileKeyboardHandler`)

- [ ] **Task 3.5.7: Mobile Navigation & Gesture System** (AC: 1, 3)
  - [ ] Subtask 3.5.7.1: Implement swipe gesture support for step navigation using React gesture libraries
  - [ ] Subtask 3.5.7.2: Add haptic feedback for supported mobile browsers and PWA
  - [ ] Subtask 3.5.7.3: Create mobile-collapsed navigation for smaller screens
  - [ ] Subtask 3.5.7.4: Implement mobile-first CSS breakpoints using Tailwind responsive system

- [ ] **Task 3.5.8: Mobile Performance Optimization** (AC: 5)
  - [ ] Subtask 3.5.8.1: Implement code splitting and lazy loading for mobile-specific components
  - [ ] Subtask 3.5.8.2: Optimize bundle size and reduce mobile data usage
  - [ ] Subtask 3.5.8.3: Add performance monitoring for mobile load times
  - [ ] Subtask 3.5.8.4: Implement efficient mobile rendering patterns with skeleton screens

- [ ] **Task 3.5.9: Offline Capabilities & PWA Features** (AC: 6, 10)
  - [ ] Subtask 3.5.9.1: Implement service worker for basic offline functionality
  - [ ] Subtask 3.5.9.2: Add data synchronization when connection is restored
  - [ ] Subtask 3.5.9.3: Create PWA manifest for app-like mobile experience
  - [ ] Subtask 3.5.9.4: Implement offline storage for draft incident data

- [ ] **Task 3.5.10: Mobile Accessibility & WCAG Compliance** (AC: 7)
  - [ ] Subtask 3.5.10.1: Validate WCAG 2.1 AA compliance across all viewport sizes
  - [ ] Subtask 3.5.10.2: Implement proper focus management for mobile screen readers
  - [ ] Subtask 3.5.10.3: Add appropriate ARIA labels and mobile-specific accessibility features
  - [ ] Subtask 3.5.10.4: Test with mobile assistive technologies

- [ ] **Task 3.5.11: Cross-Device Testing & Validation** (AC: 8, 9)
  - [ ] Subtask 3.5.11.1: Set up comprehensive mobile browser testing (iOS Safari, Android Chrome)
  - [ ] Subtask 3.5.11.2: Test across different mobile device sizes and orientations
  - [ ] Subtask 3.5.11.3: Conduct user testing sessions with frontline workers on mobile devices
  - [ ] Subtask 3.5.11.4: Document mobile-specific usage patterns and feedback

## Documentation Impact Assessment

This story establishes critical mobile-first design patterns for the SupportSignal platform:

**Architectural Patterns to Establish:**
- Mobile-first responsive design principles for healthcare workflow applications
- Touch-optimized form interaction patterns for complex multi-step processes
- Progressive Web App patterns for field-based incident reporting
- Offline-first data synchronization patterns for unreliable network conditions
- Cross-device consistency patterns for incident capture workflows

**Documentation Updates Needed:**
- Frontend mobile design system documentation
- PWA implementation patterns and service worker architecture
- Mobile accessibility patterns and WCAG compliance procedures
- Cross-device testing methodology and device compatibility matrix
- Mobile-specific performance optimization patterns

**Knowledge Capture:**
- Mobile UX patterns for complex healthcare workflows
- Touch interaction design patterns for form-heavy applications
- Offline functionality implementation for real-time databases (Convex)
- Mobile performance optimization techniques for Next.js applications

## Dev Notes

### Previous Story Insights
From Stories 3.1-3.3 (Complete Incident Capture Workflow):
- **8-Step Wizard Structure**: Metadata (Step 1), Multi-phase narrative (Step 2), AI clarification questions (Steps 3-6), Enhanced review (Step 7), Consolidated report (Step 8)
- **Existing Components**: Wizard navigation, form validation, AI integration, auto-save functionality
- **Data Flow**: Incident metadata → Narrative phases → AI-generated questions → Enhanced narrative → Final review
- **Performance Requirements**: <2 second step transitions, <10 second AI processing already established

### Current Implementation Context [Source: docs/architecture/source-tree.md]

**Frontend Structure**:
- `apps/web/` - Next.js Frontend Application with App Router
- `apps/web/components/` - React Components with existing wizard components
- `apps/web/lib/` - Utility functions including Convex client configuration

**Key Components to Optimize**:
- Wizard navigation components (existing in capture workflow)
- Form controls and validation systems
- AI integration loading states and progress indicators
- Auto-save functionality for mobile interruption handling

### Data Models [Source: docs/architecture/data-models.md]

**Incident Data Structure** (existing, mobile optimization needed):
```typescript
// Existing incident schema optimized for mobile interaction
interface IncidentMetadata {
  reporterName: string;           // Pre-filled, mobile keyboard optimized
  participantId: string;          // Touch-friendly dropdown selection
  eventDateTime: string;          // Mobile date/time picker optimization
  location: string;              // Location input with mobile autocomplete
}

interface NarrativePhases {
  beforeEvent: string;            // Mobile text area with voice input support
  duringEvent: string;           // Optimized mobile keyboard layout
  endEvent: string;              // Touch-friendly interaction patterns
  postEventSupport: string;      // Mobile-first text input optimization
}
```

### Technical Implementation [Source: docs/architecture/tech-stack.md, coding-standards.md]

**Mobile-First Technology Stack**:
- **Next.js 14.2.x**: App Router with mobile-optimized routing
- **Tailwind CSS**: Mobile-first responsive design system with breakpoints
- **ShadCN UI**: Accessible component library with touch optimization
- **TypeScript 5.4.x**: Strict mode compliance for mobile component types
- **Convex 1.12.x**: Real-time data sync for offline mobile capabilities

**Responsive Breakpoints** (mobile-first approach):
```typescript
// Mobile-first responsive system
const breakpoints = {
  mobile: '375px',    // Minimum mobile support (iPhone SE)
  tablet: '768px',    // Tablet landscape mode
  desktop: '1024px',  // Desktop and larger screens
  wide: '1440px'      // Large desktop displays
};
```

**Mobile Component Architecture**:
```typescript
// Mobile-optimized component patterns
interface MobileWizardStep {
  id: string;
  title: string;
  mobileTitle?: string;        // Shortened titles for mobile
  component: React.Component;
  touchGestures: {
    swipeLeft?: () => void;    // Next step navigation
    swipeRight?: () => void;   // Previous step navigation
    pullDown?: () => void;     // Refresh functionality
  };
  mobileValidation: ValidationRule[];
  offlineSupport: boolean;
}
```

### File Locations [Source: docs/architecture/source-tree.md]

**Frontend Mobile Implementation**:
- `apps/web/components/incident/` - Existing incident capture components to optimize
- `apps/web/components/mobile/` - New mobile-specific component variants
- `apps/web/lib/mobile/` - Mobile utilities (gestures, PWA, offline sync)
- `apps/web/hooks/` - Mobile-specific React hooks (swipe, orientation, network status)

**Mobile Asset Management**:
- `apps/web/public/` - PWA manifest, mobile icons, and assets
- `apps/web/app/manifest.json` - Progressive Web App configuration
- `apps/web/sw.js` - Service worker for offline functionality

### Technical Constraints [Source: docs/architecture/coding-standards.md]

**TypeScript Requirements**:
- Strict mode compliance for mobile component types
- No `any` type usage for touch event handlers and mobile APIs
- Full type safety for PWA and service worker implementations

**Mobile Performance Standards**:
- <3 second initial load time on 3G network conditions
- <1 second step transitions on mobile devices
- Efficient bundle splitting for mobile-first loading
- Progressive enhancement patterns for desktop features

**Accessibility Requirements** [Source: WCAG 2.1 AA compliance]:
- Minimum 44px touch targets for all interactive elements
- Proper focus management for mobile screen readers
- Appropriate contrast ratios across all viewport sizes
- Voice input compatibility and mobile assistive technology support

### Integration Points

**Convex Real-time Backend Integration** [Source: docs/architecture/components.md]:
- Offline-first data synchronization with Convex real-time capabilities
- Mobile network resilience with intelligent retry mechanisms
- Auto-save functionality optimized for mobile interruption patterns
- Real-time updates when transitioning between online/offline states

**AI Service Mobile Optimization**:
- Mobile-friendly loading states for AI question generation
- Progressive disclosure of AI processing steps on smaller screens
- Touch-optimized interfaces for AI response review and editing
- Network-efficient AI processing with mobile data considerations

### Pattern Validation

**Repository Pattern** [Source: docs/architecture/coding-standards.md]:
- All mobile data access through repository pattern
- Mobile-specific offline storage abstracted through repositories
- No direct mobile storage access from components

**Component Integration** [Source: docs/architecture/components.md]:
- Maintain existing WebApp (Next.js) → ConvexBackend real-time integration
- Preserve AIToolService integration with mobile-optimized interfaces
- Mobile-first progressive enhancement of existing component patterns

## Testing

**Testing Standards** [Source: docs/testing/technical/test-strategy-and-standards.md]:

**Test File Locations** [Source: Centralized testing pattern]:
- Unit tests: `tests/web/components/mobile/` - Mobile-specific component testing
- Integration tests: `tests/web/integration/mobile/` - Mobile workflow testing
- E2E tests: `tests/e2e/mobile/` - Cross-device mobile testing
- PWA tests: `tests/web/pwa/` - Progressive Web App functionality testing

**Testing Frameworks**:
- **Jest + RTL**: Mobile component testing with touch simulation
- **Playwright**: Mobile browser testing across iOS Safari and Android Chrome
- **Mobile Device Testing**: Physical device testing on representative mobile devices

**Key Testing Scenarios**:
- Touch navigation and gesture interactions across all 8 workflow steps
- Form input optimization on different mobile keyboard types
- Offline functionality and data synchronization testing
- PWA installation and app-like behavior validation
- Cross-device responsive layout testing (375px to 1920px+ widths)
- Mobile accessibility testing with screen readers and assistive technologies

**Coverage Requirements**:
- Unit tests: 85%+ coverage for mobile-specific components and utilities
- Integration tests: 100% coverage of mobile workflow paths and offline functionality
- E2E tests: Complete mobile incident capture workflow from start to finish
- Device testing: iOS Safari (latest 2 versions), Android Chrome (latest 2 versions)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-13 | 1.0 | Initial story creation for mobile-first responsive incident capture | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by QA Agent after story completion*

### Pattern Compliance Review
*To be filled by QA agent*

### Knowledge Capture
*To be filled by QA agent*

### Velocity Data
*To be filled by QA agent*